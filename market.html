<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Market — SUITE</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: #000000;
            color: #ffffff;
            min-height: 100vh;
        }
        
        /* Navigation */
        .nav {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            padding: 2rem 3rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 100;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        .nav-logo {
            font-size: 1.25rem;
            font-weight: 300;
            letter-spacing: 0.1em;
            color: #ffffff;
            text-decoration: none;
        }
        .nav-logo .te {
            color: #3b82f6;
        }
        .nav-links {
            display: flex;
            gap: 3rem;
        }
        .nav-links a {
            font-size: 0.875rem;
            font-weight: 300;
            color: #6b7280;
            text-decoration: none;
            transition: color 0.3s;
            letter-spacing: 0.05em;
        }
        .nav-links a:hover,
        .nav-links a.active {
            color: #3b82f6;
        }
        
        /* Main Container */
        .container {
            max-width: 90rem;
            margin: 0 auto;
            padding: 8rem 3rem 4rem 3rem;
        }
        
        .page-header {
            margin-bottom: 3rem;
        }
        
        .page-title {
            font-size: 3rem;
            font-weight: 200;
            color: #ffffff;
            margin-bottom: 0.5rem;
            letter-spacing: -0.02em;
        }
        
        .page-subtitle {
            font-size: 0.875rem;
            font-weight: 300;
            color: #6b7280;
            letter-spacing: 0.05em;
        }
        
        /* Table */
        .market-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
        }
        
        .market-table thead th {
            text-align: left;
            padding: 1rem 1.5rem;
            font-size: 0.75rem;
            font-weight: 300;
            color: #6b7280;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            background: rgba(255, 255, 255, 0.02);
            cursor: pointer;
            transition: color 0.3s;
        }
        
        .market-table thead th:hover {
            color: #ffffff;
        }
        
        .market-table thead th:first-child {
            border-top-left-radius: 4px;
        }
        
        .market-table thead th:last-child {
            border-top-right-radius: 4px;
        }
        
        .market-table tbody tr {
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            transition: background 0.3s;
        }
        
        .market-table tbody tr:hover {
            background: rgba(255, 255, 255, 0.02);
        }
        
        .market-table tbody td {
            padding: 1.5rem 1.5rem;
            font-size: 0.875rem;
            font-weight: 300;
        }
        
        .token-link {
            text-decoration: none;
            color: inherit;
        }
        
        .token-info {
            display: flex;
            align-items: center;
            gap: 1rem;
            cursor: pointer;
            transition: opacity 0.3s;
        }
        
        .token-info:hover {
            opacity: 0.7;
        }
        
        .token-icon {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: rgba(59, 130, 246, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: 500;
            color: #3b82f6;
        }
        
        .token-name {
            display: flex;
            flex-direction: column;
        }
        
        .token-symbol {
            font-size: 0.875rem;
            font-weight: 400;
            color: #ffffff;
        }
        
        .token-full-name {
            font-size: 0.75rem;
            color: #6b7280;
        }
        
        .price {
            color: #ffffff;
            font-weight: 400;
        }
        
        .change-positive {
            color: #10b981;
        }
        
        .change-negative {
            color: #ef4444;
        }
        
        .chart-cell {
            width: 150px;
        }
        
        .mini-chart {
            width: 100%;
            height: 40px;
        }
        
        .loading {
            text-align: center;
            padding: 4rem;
            color: #6b7280;
            font-size: 0.875rem;
        }
        
        .error {
            text-align: center;
            padding: 4rem;
            color: #ef4444;
            font-size: 0.875rem;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 8rem 1.5rem 4rem 1.5rem;
            }
            
            .market-table {
                font-size: 0.75rem;
            }
            
            .chart-cell {
                display: none;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="nav">
        <a href="index.html" class="nav-logo">SUI<span class="te">TE</span></a>
        <div class="nav-links">
            <a href="index.html">Home</a>
            <a href="market.html" class="active">Market</a>
            <a href="news.html">News</a>
        </div>
    </nav>
    
    <!-- Main Content -->
    <div class="container">
        <div class="page-header">
            <h1 class="page-title">Ecosystem Market</h1>
            <p class="page-subtitle">SUI ecosystem tokens · Real-time data</p>
        </div>
        
        <div id="table-container">
            <div class="loading">Loading market data...</div>
        </div>
    </div>
    
    <script>
        // Token list - Add new tokens here!
        const tokens = [
            // Original tokens (with corrected IDs)
            { symbol: 'DEEP', name: 'DeepBook', id: 'deepbook' },
            { symbol: 'WAL', name: 'Walrus', id: 'walrus-2' },
            { symbol: 'NS', name: 'SuiNS', id: 'suins-token' },
            { symbol: 'ALKIMI', name: 'Alkimi', id: 'alkimi' },
            { symbol: 'SEND', name: 'Suilend', id: 'suilend' },
            { symbol: 'IKA', name: 'Ika', id: 'ika' },
            { symbol: 'BUCK', name: 'Bucket', id: 'bucket-token' },
            
            // New tokens
            { symbol: 'NAVX', name: 'Navi', id: 'navi' },
            { symbol: 'HAE', name: 'Haedal', id: 'haedal-protocol' },
            { symbol: 'BLUE', name: 'Bluefin', id: 'bluefin' },
            { symbol: 'CETUS', name: 'Cetus', id: 'cetus-protocol' },
            { symbol: 'ALPHA', name: 'AlphaFi', id: 'alpha-fi' },
            { symbol: 'SCA', name: 'Scallop', id: 'scallop-2' },
            { symbol: 'DBL', name: 'DoubleUp', id: 'doubleup' },
            { symbol: 'MOM', name: 'Momentum', id: 'momentum-2' },
            { symbol: 'MNFST', name: 'Manifest', id: 'manifest-3' },
            { symbol: 'LOFI', name: 'Lofi', id: 'lofi-2' }
        ];
        
        let marketData = [];
        let sortColumn = 'marketCap';
        let sortDirection = 'desc';
        
        async function fetchMarketData() {
            try {
                const ids = tokens.map(t => t.id).join(',');
                const response = await fetch(
                    `https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&ids=${ids}&order=market_cap_desc&sparkline=true&price_change_percentage=24h`
                );
                
                if (!response.ok) throw new Error('Failed to fetch market data');
                
                const data = await response.json();
                
                // Map the data to our token list
                marketData = tokens.map(token => {
                    const coinData = data.find(d => d.id === token.id);
                    return {
                        symbol: token.symbol,
                        name: token.name,
                        id: token.id,
                        price: coinData?.current_price || 0,
                        marketCap: coinData?.market_cap || 0,
                        volume: coinData?.total_volume || 0,
                        change24h: coinData?.price_change_percentage_24h || 0,
                        sparkline: coinData?.sparkline_in_7d?.price || []
                    };
                });
                
                renderTable();
            } catch (error) {
                console.error('Error fetching market data:', error);
                document.getElementById('table-container').innerHTML = 
                    '<div class="error">Unable to load market data. Please try again later.</div>';
            }
        }
        
        function formatNumber(num) {
            if (num === 0 || num === null || num === undefined) {
                return '<span style="color: #6b7280; font-size: 0.75rem;">Data unavailable</span>';
            }
            if (num >= 1e9) return '$' + (num / 1e9).toFixed(2) + 'B';
            if (num >= 1e6) return '$' + (num / 1e6).toFixed(2) + 'M';
            if (num >= 1e3) return '$' + (num / 1e3).toFixed(2) + 'K';
            return '$' + num.toFixed(2);
        }
        
        function formatPrice(price) {
            if (price === 0 || price === null || price === undefined) {
                return '<span style="color: #6b7280; font-size: 0.75rem;">Data unavailable</span>';
            }
            if (price >= 1) return '$' + price.toFixed(2);
            if (price >= 0.01) return '$' + price.toFixed(4);
            return '$' + price.toFixed(6);
        }
        
        function drawMiniChart(canvasId, data) {
            const canvas = document.getElementById(canvasId);
            if (!canvas || data.length === 0) return;
            
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            
            const values = data.filter(v => v !== null && v !== undefined);
            if (values.length === 0) return;
            
            const min = Math.min(...values);
            const max = Math.max(...values);
            const range = max - min || 1;
            
            ctx.clearRect(0, 0, width, height);
            
            // Determine color based on trend
            const firstValue = values[0];
            const lastValue = values[values.length - 1];
            const color = lastValue >= firstValue ? '#10b981' : '#ef4444';
            
            ctx.strokeStyle = color;
            ctx.lineWidth = 1.5;
            ctx.beginPath();
            
            values.forEach((value, i) => {
                const x = (i / (values.length - 1)) * width;
                const y = height - ((value - min) / range) * height;
                
                if (i === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            });
            
            ctx.stroke();
        }
        
        function sortTable(column) {
            if (sortColumn === column) {
                sortDirection = sortDirection === 'asc' ? 'desc' : 'asc';
            } else {
                sortColumn = column;
                sortDirection = 'desc';
            }
            
            marketData.sort((a, b) => {
                let aVal = a[column];
                let bVal = b[column];
                
                if (sortDirection === 'asc') {
                    return aVal - bVal;
                } else {
                    return bVal - aVal;
                }
            });
            
            renderTable();
        }
        
        function renderTable() {
            const html = `
                <table class="market-table">
                    <thead>
                        <tr>
                            <th onclick="sortTable('name')">Token</th>
                            <th onclick="sortTable('price')">Price</th>
                            <th onclick="sortTable('change24h')">24h %</th>
                            <th onclick="sortTable('marketCap')">Market Cap</th>
                            <th onclick="sortTable('volume')">Volume (24h)</th>
                            <th>Last 7 Days</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${marketData.map((token, index) => `
                            <tr>
                                <td>
                                    <a href="https://www.coingecko.com/en/coins/${token.id}" target="_blank" class="token-link">
                                        <div class="token-info">
                                            <div class="token-icon">${token.symbol.substring(0, 2)}</div>
                                            <div class="token-name">
                                                <span class="token-symbol">${token.symbol}</span>
                                                <span class="token-full-name">${token.name}</span>
                                            </div>
                                        </div>
                                    </a>
                                </td>
                                <td class="price">${formatPrice(token.price)}</td>
                                <td class="${token.change24h >= 0 ? 'change-positive' : 'change-negative'}">
                                    ${token.change24h === 0 ? '<span style="color: #6b7280; font-size: 0.75rem;">Data unavailable</span>' : (token.change24h >= 0 ? '+' : '') + token.change24h.toFixed(2) + '%'}
                                </td>
                                <td>${formatNumber(token.marketCap)}</td>
                                <td>${formatNumber(token.volume)}</td>
                                <td class="chart-cell">
                                    <canvas id="chart-${index}" class="mini-chart" width="150" height="40"></canvas>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            
            document.getElementById('table-container').innerHTML = html;
            
            // Draw all mini charts
            marketData.forEach((token, index) => {
                drawMiniChart(`chart-${index}`, token.sparkline);
            });
        }
        
        // Initial load
        fetchMarketData();
        
        // Refresh every 60 seconds
        setInterval(fetchMarketData, 60000);
    </script>
</body>
</html>
