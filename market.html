<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Market — SUITE</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: #000000;
            color: #ffffff;
            min-height: 100vh;
        }
        
        /* Navigation */
        .nav {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            padding: 2rem 3rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 100;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        .nav-logo {
            font-size: 1.25rem;
            font-weight: 300;
            letter-spacing: 0.1em;
            color: #ffffff;
            text-decoration: none;
        }
        .nav-logo .te {
            color: #3b82f6;
        }
        .nav-links {
            display: flex;
            gap: 3rem;
        }
        .nav-links a {
            font-size: 0.875rem;
            font-weight: 300;
            color: #6b7280;
            text-decoration: none;
            transition: color 0.3s;
            letter-spacing: 0.05em;
        }
        .nav-links a:hover,
        .nav-links a.active {
            color: #3b82f6;
        }
        
        /* Main Container */
        .container {
            max-width: 90rem;
            margin: 0 auto;
            padding: 8rem 3rem 4rem 3rem;
        }
        
        .page-header {
            margin-bottom: 3rem;
        }
        
        .page-title {
            font-size: 3rem;
            font-weight: 200;
            color: #ffffff;
            margin-bottom: 0.5rem;
            letter-spacing: -0.02em;
        }
        
        .page-subtitle {
            font-size: 0.875rem;
            font-weight: 300;
            color: #6b7280;
            letter-spacing: 0.05em;
        }
        
        /* Search Bar */
        .search-container {
            display: flex;
            justify-content: flex-end;
            margin-bottom: 1rem;
        }
        
        .search-input {
            width: 100%;
            max-width: 350px;
            padding: 0.75rem 1rem;
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            color: #ffffff;
            font-size: 0.875rem;
            font-weight: 300;
            letter-spacing: 0.02em;
            transition: all 0.3s;
        }
        
        .search-input:focus {
            outline: none;
            border-color: #3b82f6;
            background: rgba(255, 255, 255, 0.05);
        }
        
        .search-input::placeholder {
            color: #6b7280;
        }
        
        /* Table */
        .market-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
        }
        
        .market-table thead th {
            text-align: left;
            padding: 1rem 1.5rem;
            font-size: 0.75rem;
            font-weight: 300;
            color: #6b7280;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            background: rgba(255, 255, 255, 0.02);
            cursor: pointer;
            transition: color 0.3s;
        }
        
        .market-table thead th:hover {
            color: #ffffff;
        }
        
        .market-table thead th:first-child {
            border-top-left-radius: 4px;
        }
        
        .market-table thead th:last-child {
            border-top-right-radius: 4px;
        }
        
        .market-table tbody tr {
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            transition: background 0.3s;
        }
        
        .market-table tbody tr:hover {
            background: rgba(255, 255, 255, 0.02);
        }
        
        .market-table tbody tr.hidden {
            display: none;
        }
        
        .market-table tbody td {
            padding: 1.5rem 1.5rem;
            font-size: 0.875rem;
            font-weight: 300;
        }
        
        .token-link {
            text-decoration: none;
            color: inherit;
        }
        
        .token-info {
            display: flex;
            align-items: center;
            gap: 1rem;
            cursor: pointer;
            transition: opacity 0.3s;
        }
        
        .token-info:hover {
            opacity: 0.7;
        }
        
        .token-icon {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: rgba(59, 130, 246, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: 500;
            color: #3b82f6;
            overflow: hidden;
            flex-shrink: 0;
        }
        
        .token-icon img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .token-icon-fallback {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;
        }
        
        .token-name {
            display: flex;
            flex-direction: column;
        }
        
        .token-symbol {
            font-size: 0.875rem;
            font-weight: 400;
            color: #ffffff;
        }
        
        .token-full-name {
            font-size: 0.75rem;
            color: #6b7280;
        }
        
        .category-badges {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }
        
        .category-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 400;
            letter-spacing: 0.02em;
            white-space: nowrap;
        }
        
        .category-defi {
            background: rgba(59, 130, 246, 0.1);
            color: #3b82f6;
            border: 1px solid rgba(59, 130, 246, 0.2);
        }
        
        .category-infrastructure {
            background: rgba(6, 182, 212, 0.1);
            color: #06b6d4;
            border: 1px solid rgba(6, 182, 212, 0.2);
        }
        
        .category-ads {
            background: rgba(236, 72, 153, 0.1);
            color: #ec4899;
            border: 1px solid rgba(236, 72, 153, 0.2);
        }
        
        .category-gambling {
            background: rgba(245, 158, 11, 0.1);
            color: #f59e0b;
            border: 1px solid rgba(245, 158, 11, 0.2);
        }
        
        .category-meme {
            background: rgba(139, 92, 246, 0.1);
            color: #8b5cf6;
            border: 1px solid rgba(139, 92, 246, 0.2);
        }
        
        .category-brand {
            background: rgba(251, 191, 36, 0.1);
            color: #fbbf24;
            border: 1px solid rgba(251, 191, 36, 0.2);
        }
        
        .price {
            color: #ffffff;
            font-weight: 400;
        }
        
        .change-positive {
            color: #10b981;
        }
        
        .change-negative {
            color: #ef4444;
        }
        
        .chart-cell {
            width: 150px;
        }
        
        .mini-chart {
            width: 100%;
            height: 40px;
        }
        
        .loading {
            text-align: center;
            padding: 4rem;
            color: #6b7280;
            font-size: 0.875rem;
        }
        
        .error {
            text-align: center;
            padding: 4rem;
            color: #ef4444;
            font-size: 0.875rem;
        }
        
        .no-results {
            text-align: center;
            padding: 4rem;
            color: #6b7280;
            font-size: 0.875rem;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 8rem 1.5rem 4rem 1.5rem;
            }
            
            .market-table {
                font-size: 0.75rem;
            }
            
            .chart-cell {
                display: none;
            }
            
            .search-container {
                justify-content: flex-start;
                margin-bottom: 1.5rem;
            }
            
            .search-input {
                max-width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="nav">
        <a href="index.html" class="nav-logo">SUI<span class="te">TE</span></a>
        <div class="nav-links">
            <a href="index.html">Home</a>
            <a href="market.html" class="active">Market</a>
            <a href="news.html">News</a>
        </div>
    </nav>
    
    <!-- Main Content -->
    <div class="container">
        <div class="page-header">
            <h1 class="page-title">Ecosystem Market</h1>
            <p class="page-subtitle">SUI ecosystem tokens · Real-time data</p>
        </div>
        
        <!-- Search Bar (above table, right-aligned) -->
        <div class="search-container">
            <input 
                type="text" 
                id="search-input" 
                class="search-input" 
                placeholder="Search by token or category (e.g., Dex, Lending, CLOB)..."
                oninput="filterTokens()"
            />
        </div>
        
        <div id="table-container">
            <div class="loading">Loading market data...</div>
        </div>
    </div>
    
    <script>
        // Token list with DexScreener pair addresses on Sui
        const tokens = [
            // DeFi - Dex
            { symbol: 'DEEP', name: 'DeepBook', pairAddress: '0xe01243f37f712ef87e556afb9b1d03d0fae13f96d324ec912daffc339dfdcbd2', category: 'DeFi', subcategories: ['Dex', 'CLOB'], searchUrl: 'deepbook' },
            { symbol: 'CETUS', name: 'Cetus', pairAddress: '0x2e041f3fd93646dcc877f783c1f2b7fa62d30271bdef1f21ef002cebf857bded', category: 'DeFi', subcategories: ['Dex'], searchUrl: 'cetus' },
            { symbol: 'MMT', name: 'Momentum', pairAddress: '0xc7993ebf7a1e629a942f69e9b3a8dccc3a96db0df3991812578815a0dda08a91', category: 'DeFi', subcategories: ['Dex'], searchUrl: 'momentum' },
            { symbol: 'BLUE', name: 'Bluefin', pairAddress: '0x4b8271fc4819078e44ee9a0506a824b77464789d57ace355d0562a4776c51840', category: 'DeFi', subcategories: ['Dex', 'Trading'], searchUrl: 'bluefin' },
            
            // DeFi - Lending
            { symbol: 'SCA', name: 'Scallop', pairAddress: '0xb62e60fa7dc5b32f069532ff8182a6aee264dd7ae658c863db186e68b4e06229', category: 'DeFi', subcategories: ['Lending'], searchUrl: 'scallop' },
            { symbol: 'NAVX', name: 'Navi', pairAddress: '0x0254747f5ca059a1972cd7f6016485d51392a3fde608107b93bbaebea550f703', category: 'DeFi', subcategories: ['Lending', 'Staking'], searchUrl: 'navi' },
            { symbol: 'SEND', name: 'Suilend', pairAddress: '0x30cf88801f636759645dc8e63b32a4f8166d081defdf325c2da5c97a782aface', category: 'DeFi', subcategories: ['Lending', 'Staking', 'AMM'], searchUrl: 'suilend' },
            { symbol: 'ALPHA', name: 'AlphaFi', pairAddress: '0xd4051b5dc76ca354e48813268aa79de38b274878ef6a9d274066ae5a47f46cc6', category: 'DeFi', subcategories: ['Lending', 'Staking'], searchUrl: 'alphafi' },
            
            // DeFi - Staking
            { symbol: 'HAEDAL', name: 'Haedal', pairAddress: '0x711f5d37e3b09b026b182d9e0973d05e9a837d11066ff48f4a55a426d8913359', category: 'DeFi', subcategories: ['Staking'], searchUrl: 'haedal' },
            
            // DeFi - Stablecoin
            { symbol: 'BUT', name: 'Bucket', pairAddress: '0x68d16416770f9b73b0b1b45e118f6ea3a2910f548f942fe335824fd515cdff08', category: 'DeFi', subcategories: ['Stablecoin'], searchUrl: 'bucket' },
            
            // DeFi - Payments
            { symbol: 'XMN', name: 'xMoney', pairAddress: '0x536ff36330cf71dadd45cdfed9372c4cc9a5be57b9fbf728040fd2c4516ffb6c', category: 'DeFi', subcategories: ['Payments'], searchUrl: 'xmoney' },
            
            // Infrastructure
            { symbol: 'WAL', name: 'Walrus', pairAddress: '0x919a34b9df1d7a56fa078ae6ddc6bd203e284974704d85721062d38ee3a6701a', category: 'Infrastructure', subcategories: ['Data Storage'], searchUrl: 'walrus' },
            { symbol: 'IKA', name: 'Ika', pairAddress: '0x5fa94e0cb243f0e50f126416e940ff61a95c0ba0b903608df6640d74609e84c9', category: 'Infrastructure', subcategories: ['Interoperability'], searchUrl: 'ika' },
            { symbol: 'NS', name: 'SuiNS', pairAddress: '0x1595b46012324ae6050cd146fbe0c95420eb96f557eda462c93526c01e179735', category: 'Infrastructure', subcategories: ['Domain'], searchUrl: 'suins' },
            
            // Brand
            { symbol: 'DMC', name: 'Delorean', pairAddress: '0xa288810f820498f7c2bca41cfadea3e99bd152b3dbeb2c282bb4b9c909f71c6d', category: 'Brand', subcategories: ['Car'], searchUrl: 'delorean' },
            
            // Other categories
            { symbol: 'ALKIMI', name: 'Alkimi', pairAddress: '0x5cf7e2ec9311d9057e43477a29bd457c51beeb1ddcd151c385a295dbb3c0fb18', category: 'Ads', subcategories: [], searchUrl: 'alkimi' },
            { symbol: 'UP', name: 'DoubleUp', pairAddress: '0x3b4589a67fb75a9cbbaa8e90980ae02961c24a86638649450ca4b0278d64f538', category: 'Gambling', subcategories: [], searchUrl: 'doubleup' },
            { symbol: 'LOFI', name: 'Lofi', pairAddress: '0xd6147f5f50e2f9f593557e497c9ee0f2387652e2a4ad73ee28bd0bdef5e3f51d', category: 'Meme', subcategories: ['Charity'], searchUrl: 'lofi' },
            { symbol: 'MANIFEST', name: 'Manifest', pairAddress: '0x15a1adef56e1b716c29a6ce7df539fd7b8080da283199c92c6caa6f641a61c3f', category: 'Meme', subcategories: ['Movement', 'DAT'], searchUrl: 'manifest' }
        ];
        
        let marketData = [];
        let sortColumn = 'marketCap';
        let sortDirection = 'desc';
        
        function getCategoryClass(category) {
            const categoryMap = {
                'DeFi': 'defi',
                'Infrastructure': 'infrastructure',
                'Ads': 'ads',
                'Gambling': 'gambling',
                'Meme': 'meme',
                'Brand': 'brand'
            };
            return `category-${categoryMap[category] || 'defi'}`;
        }
        
        async function fetchMarketData() {
            try {
                console.log('Fetching data from DexScreener...');
                
                // Fetch data for all tokens from DexScreener
                const promises = tokens.map(async token => {
                    try {
                        // Try multiple search variations
                        const searchTerms = [
                            `${token.symbol} sui`,
                            `${token.name} sui`,
                            token.symbol,
                            token.name
                        ];
                        
                        let bestPair = null;
                        
                        for (const searchTerm of searchTerms) {
                            const response = await fetch(
                                `https://api.dexscreener.com/latest/dex/search?q=${encodeURIComponent(searchTerm)}`
                            );
                            
                            if (!response.ok) continue;
                            
                            const data = await response.json();
                            
                            // Find Sui pairs that match this token
                            const suiPairs = data.pairs?.filter(p => {
                                if (p.chainId !== 'sui') return false;
                                
                                const baseMatch = p.baseToken?.symbol?.toUpperCase() === token.symbol.toUpperCase();
                                const quoteMatch = p.quoteToken?.symbol?.toUpperCase() === token.symbol.toUpperCase();
                                
                                return baseMatch || quoteMatch;
                            });
                            
                            if (suiPairs && suiPairs.length > 0) {
                                // Get the pair with highest liquidity
                                bestPair = suiPairs.sort((a, b) => 
                                    (parseFloat(b.liquidity?.usd) || 0) - (parseFloat(a.liquidity?.usd) || 0)
                                )[0];
                                
                                console.log(`✓ ${token.symbol}: Found via "${searchTerm}" with $${formatLiquidity(parseFloat(bestPair.liquidity?.usd || 0))} liquidity`);
                                break;
                            }
                        }
                        
                        if (!bestPair) {
                            console.warn(`⚠ ${token.symbol}: No data found`);
                            // Return token with zero values to still show it in the table
                            return {
                                symbol: token.symbol,
                                name: token.name,
                                category: token.category,
                                subcategories: token.subcategories,
                                price: 0,
                                marketCap: 0,
                                fdv: 0,
                                volume: 0,
                                change24h: 0,
                                liquidity: 0,
                                pairAddress: null,
                                dexUrl: null,
                                logo: null
                            };
                        }
                        
                        // Determine which token is the base (our token vs pairing token like SUI/USDC)
                        const isBase = bestPair.baseToken?.symbol?.toUpperCase() === token.symbol.toUpperCase();
                        const tokenData = isBase ? bestPair.baseToken : bestPair.quoteToken;
                        
                        return {
                            symbol: token.symbol,
                            name: token.name,
                            category: token.category,
                            subcategories: token.subcategories,
                            price: parseFloat(bestPair.priceUsd) || 0,
                            marketCap: parseFloat(bestPair.marketCap) || 0,
                            fdv: parseFloat(bestPair.fdv) || 0,
                            volume: parseFloat(bestPair.volume?.h24) || 0,
                            change24h: parseFloat(bestPair.priceChange?.h24) || 0,
                            liquidity: parseFloat(bestPair.liquidity?.usd) || 0,
                            pairAddress: bestPair.pairAddress,
                            dexUrl: bestPair.url,
                            logo: tokenData?.image || bestPair.info?.imageUrl || null
                        };
                    } catch (error) {
                        console.error(`✗ ${token.symbol}: ${error.message}`);
                        // Return token with zero values to still show it
                        return {
                            symbol: token.symbol,
                            name: token.name,
                            category: token.category,
                            subcategories: token.subcategories,
                            price: 0,
                            marketCap: 0,
                            fdv: 0,
                            volume: 0,
                            change24h: 0,
                            liquidity: 0,
                            pairAddress: null,
                            dexUrl: null,
                            logo: null
                        };
                    }
                });
                
                marketData = await Promise.all(promises);
                
                const tokensWithData = marketData.filter(t => t.price > 0).length;
                console.log(`Successfully loaded data for ${tokensWithData}/${tokens.length} tokens`);
                
                // Initial sort by market cap
                sortByMarketCap();
                renderTable();
            } catch (error) {
                console.error('Error fetching market data:', error);
                document.getElementById('table-container').innerHTML = 
                    '<div class="error">Unable to load market data. Please try again later.</div>';
            }
        }
        
        function formatLiquidity(num) {
            if (num >= 1e6) return (num / 1e6).toFixed(2) + 'M';
            if (num >= 1e3) return (num / 1e3).toFixed(2) + 'K';
            return num.toFixed(0);
        }
        
        function sortByMarketCap() {
            marketData.sort((a, b) => b.marketCap - a.marketCap);
        }
        
        function filterTokens() {
            const searchTerm = document.getElementById('search-input').value.toLowerCase();
            const rows = document.querySelectorAll('.market-table tbody tr');
            let visibleCount = 0;
            
            rows.forEach(row => {
                const tokenData = row.getAttribute('data-search');
                if (tokenData.includes(searchTerm)) {
                    row.classList.remove('hidden');
                    visibleCount++;
                } else {
                    row.classList.add('hidden');
                }
            });
            
            // Show "no results" message if nothing matches
            const noResults = document.getElementById('no-results');
            if (visibleCount === 0 && searchTerm !== '') {
                if (!noResults) {
                    const msg = document.createElement('div');
                    msg.id = 'no-results';
                    msg.className = 'no-results';
                    msg.textContent = `No tokens found matching "${searchTerm}"`;
                    document.getElementById('table-container').appendChild(msg);
                }
            } else if (noResults) {
                noResults.remove();
            }
        }
        
        function formatNumber(num) {
            if (num === 0 || num === null || num === undefined) {
                return '<span style="color: #6b7280; font-size: 0.75rem;">Data unavailable</span>';
            }
            if (num >= 1e9) return '$' + (num / 1e9).toFixed(2) + 'B';
            if (num >= 1e6) return '$' + (num / 1e6).toFixed(2) + 'M';
            if (num >= 1e3) return '$' + (num / 1e3).toFixed(2) + 'K';
            return '$' + num.toFixed(2);
        }
        
        function formatPrice(price) {
            if (price === 0 || price === null || price === undefined) {
                return '<span style="color: #6b7280; font-size: 0.75rem;">Data unavailable</span>';
            }
            if (price >= 1) return '$' + price.toFixed(2);
            if (price >= 0.01) return '$' + price.toFixed(4);
            return '$' + price.toFixed(6);
        }
        
        function getTokenIconHTML(token) {
            if (token.logo) {
                return `
                    <img 
                        src="${token.logo}" 
                        alt="${token.symbol}" 
                        loading="lazy"
                        onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';"
                    />
                    <div class="token-icon-fallback" style="display: none;">
                        ${token.symbol.substring(0, 2)}
                    </div>
                `;
            } else {
                return `<div class="token-icon-fallback">${token.symbol.substring(0, 2)}</div>`;
            }
        }
        
        function sortTable(column) {
            if (sortColumn === column) {
                sortDirection = sortDirection === 'asc' ? 'desc' : 'asc';
            } else {
                sortColumn = column;
                sortDirection = 'desc';
            }
            
            marketData.sort((a, b) => {
                let aVal = a[column];
                let bVal = b[column];
                
                // Handle string sorting (for category and name)
                if (column === 'category' || column === 'name') {
                    if (sortDirection === 'asc') {
                        return aVal.localeCompare(bVal);
                    } else {
                        return bVal.localeCompare(aVal);
                    }
                }
                
                // Handle numeric sorting (for price, marketCap, etc.)
                if (sortDirection === 'asc') {
                    return aVal - bVal;
                } else {
                    return bVal - aVal;
                }
            });
            
            renderTable();
        }
        
        function renderTable() {
            const html = `
                <table class="market-table">
                    <thead>
                        <tr>
                            <th onclick="sortTable('name')">Token</th>
                            <th onclick="sortTable('category')">Category</th>
                            <th onclick="sortTable('price')">Price</th>
                            <th onclick="sortTable('change24h')">24h %</th>
                            <th onclick="sortTable('marketCap')">Market Cap</th>
                            <th onclick="sortTable('fdv')">FDV</th>
                            <th onclick="sortTable('volume')">Volume (24h)</th>
                            <th onclick="sortTable('liquidity')">Liquidity</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${marketData.map((token, index) => {
                            const allCategories = [token.category, ...token.subcategories].join(' ').toLowerCase();
                            const searchData = `${token.symbol.toLowerCase()} ${token.name.toLowerCase()} ${allCategories}`;
                            
                            return `
                            <tr data-search="${searchData}">
                                <td>
                                    <a href="${token.dexUrl || '#'}" target="_blank" class="token-link">
                                        <div class="token-info">
                                            <div class="token-icon">
                                                ${getTokenIconHTML(token)}
                                            </div>
                                            <div class="token-name">
                                                <span class="token-symbol">${token.symbol}</span>
                                                <span class="token-full-name">${token.name}</span>
                                            </div>
                                        </div>
                                    </a>
                                </td>
                                <td>
                                    <div class="category-badges">
                                        <span class="category-badge ${getCategoryClass(token.category)}">${token.category}</span>
                                        ${token.subcategories.map(sub => 
                                            `<span class="category-badge ${getCategoryClass(token.category)}">${sub}</span>`
                                        ).join('')}
                                    </div>
                                </td>
                                <td class="price">${formatPrice(token.price)}</td>
                                <td class="${token.change24h >= 0 ? 'change-positive' : 'change-negative'}">
                                    ${token.change24h === 0 ? '<span style="color: #6b7280; font-size: 0.75rem;">Data unavailable</span>' : (token.change24h >= 0 ? '+' : '') + token.change24h.toFixed(2) + '%'}
                                </td>
                                <td>${formatNumber(token.marketCap)}</td>
                                <td>${formatNumber(token.fdv)}</td>
                                <td>${formatNumber(token.volume)}</td>
                                <td>${formatNumber(token.liquidity)}</td>
                            </tr>
                        `}).join('')}
                    </tbody>
                </table>
            `;
            
            document.getElementById('table-container').innerHTML = html;
        }
        
        // Initial load
        fetchMarketData();
        
        // Refresh every 60 seconds
        setInterval(fetchMarketData, 60000);
    </script>
</body>
</html>
